---
title: "ChatGPTã®APIã‚’GASã‹ã‚‰å‘¼ã³å‡ºã™"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GAS","ChatGPT"]
published: true
---

# ã‚„ã‚ŠãŸã„ã“ã¨
* GASã‹ã‚‰ChatGPTã®APIã‚’å‘¼ã³å‡ºã—ãŸã„ã€‚
* ç–é€šç¢ºèªãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ã€æœ€ä½é™å‹•ä½œã™ã‚Œã°OKã€‚

:::message
ã¡ãªã¿ã«å®Ÿè£…ã¯ChatGPTã«æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚
:::

# æº–å‚™
* Chat GPTã®æœ‰æ–™ç‰ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã€APIã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥æ‰‹ã€‚ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã®å–ã‚Šæ‰±ã„ã«ã¯æ³¨æ„ã™ã‚‹ã“ã¨ï¼‰
* GASã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€‚

# å®Ÿè£…ã®æ‰‹é †
GASã«ã€Œindex.htmlã€ã¨ã€Œcode.gsã€ã®äºŒã¤ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚

```html:index.html
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <textarea id="inputText" rows="4" cols="50"></textarea><br>
    <button id="submitBtn">é€ä¿¡</button>
    <p id="responseArea"></p>

    <script>
      document.getElementById("submitBtn").addEventListener("click", function(){
        var userInput = document.getElementById("inputText").value;
        google.script.run.withSuccessHandler(updateResponse).getGpt3Response(userInput);
      });

      function updateResponse(response) {
        document.getElementById("responseArea").innerHTML = response;
      }
    </script>
  </body>
</html>
```

```gs:Code.gs
function doGet() {
  return HtmlService.createHtmlOutputFromFile('index.html');
}

function getGpt3Response(userInput) {
  var apiKey = ""; // ã“ã“ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥ã‚Œã‚‹ã€‚
  var apiUrl = "https://api.openai.com/v1/chat/completions";
  const messages = [{'role': 'user', 'content': userInput}];
  const headers = {
    'Authorization':'Bearer '+ apiKey,ã€€// èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼
    'Content-type': 'application/json',
    'X-Slack-No-Retry': 1ã€€// ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ç”¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼
  };
  const options = {
    'muteHttpExceptions' : true,
    'headers': headers, 
    'method': 'POST',
    'payload': JSON.stringify({
      'model': 'gpt-3.5-turbo',
      'max_tokens' : 1024,
      'temperature' : 0.9,
      'messages': messages})
  };
  var httpresponse = UrlFetchApp.fetch(apiUrl, options);// APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®Ÿè¡Œ
  var statusCode = httpresponse.getResponseCode();// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®å–å¾—
  var contentText = httpresponse.getContentText();// å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆã®å–å¾—
  var response = JSON.parse(contentText);// å¿œç­”ã®JSONè§£æ
  if(statusCode != 200){
    var text = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼š" + statusCode + " ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š" + contentText;// ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
  } else {
    var text = response.choices[0].message.content;// æˆåŠŸæ™‚ã®å‡¦ç†
  }
  return text;
}
```

# è£œè¶³

## modelã«ã¤ã„ã¦

https://platform.openai.com/docs/models

GPT3.5ã‚„GPT4.0ä»¥å¤–ã«ã‚‚ã•ã¾ã–ã¾ãªmodelãŒã‚ã‚‹ãŸã‚ã€ä½¿ç”¨æ™‚ã¯ç¢ºèªã—ãŸã»ã†ãŒã‚ˆã•ãã†ã§ã™ã€‚ã™ã§ã«å»ƒæ­¢ã•ã‚ŒãŸmodelã‚„ã€æ”¯æ‰•ã„çŠ¶æ³ã«ã‚ˆã£ã¦ã¯ã¾ã ä½¿ç”¨ã§ããªã„modelãªã©ã‚‚ã‚ã‚‹ã‚‰ã—ã„ã€‚

## temperatureã«ã¤ã„ã¦

https://platform.openai.com/docs/guides/gpt/how-should-i-set-the-temperature-parameter

å€¤ãŒä½ã„ã¨å‡ºåŠ›ã®ä¸€è²«æ€§ãŒé«˜ã¾ã‚Šã€å€¤ã‚’é«˜ãã™ã‚‹ã¨ã€å¤šæ§˜ã§å‰µé€ çš„ãªçµæœãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã®ã“ã¨ã§ã™ã€‚

## roleã«ã¤ã„ã¦

https://platform.openai.com/docs/guides/gpt/chat-completions-api

ã“ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ChatGPTã«å¯¾ã—ã¦å½¹å‰²ã‚’ä»˜ä¸ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚


# æœ€çµ‚çš„ãªæŒ™å‹•
ã“ã¡ã‚‰ã®è³ªå•ã«å¯¾ã—ã¦ã€è¿”äº‹ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/6d2ee821ce31-20230817.png)

è³ªå•ã‚’å…¥ã‚Œã¦ã€ã€Œé€ä¿¡ã€ã‚’æŠ¼ã™ã¨â€¦â€¦ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f2660886914c-20230817.png)

å›ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚æˆåŠŸï¼
